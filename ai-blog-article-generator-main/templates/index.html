{% extends "base.html" %}

{% block title %}Home â€” AI Blog Generator{% endblock %}

{% block head %}
<style>
  /* Set Poppins as the primary font for the entire body */
  body {
    font-family: 'Poppins', sans-serif;
  }

  /* Standard Loading Animation */
  @keyframes rotate {
    from {
      transform: rotate(0deg);
    }

    to {
      transform: rotate(360deg);
    }
  }

  .load {
    width: 80px;
    height: 80px;
    margin: 50px auto;
    border: 8px solid #a855f7;
    /* Indigo-400 */
    border-top-color: transparent;
    border-radius: 50%;
    animation: rotate 1s linear infinite;
  }

  /* Enhanced Glassmorphism Effect */
  .glass {
    background: rgba(255, 255, 255, 0.6);
    /* Slightly more transparent */
    backdrop-filter: blur(25px) saturate(180%);
    /* Increased blur and saturation */
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.35);
    /* Stronger shadow */
    border: 1px solid rgba(255, 255, 255, 0.4);
    /* Subtle white border */
  }

  .hover\:shadow-3xl:hover {
    box-shadow: 0 35px 60px -15px rgba(0, 0, 0, 0.4);
  }

  /* Light mode â€” keep normal gray text */
  .ai-desc {
    color: #4B5563;
    /* gray-600 */
  }

  /* Dark mode â€” turn full paragraph white */
  .dark .ai-desc {
    color: #fff !important;
  }

  .dark .link-desc {
    color: #000000 !important;
    font-style: italic;
  }


  /* Ensure the robot icon has a nice bounce */
  @keyframes bounce {

    0%,
    100% {
      transform: translateY(0);
    }

    50% {
      transform: translateY(-10px);
    }
  }

  .animate-bounce {
    animation: bounce 1s infinite ease-in-out;
  }
</style>
{% endblock %}

{% block content %}

<section class="text-center mt-12 mb-8 px-6">
  <h2 class="text-4xl font-extrabold text-purple-700 mb-4 tracking-tight">
    Transform <span class="text-blue-600">YouTube Videos</span> into <span class="text-indigo-600">Insightful
      Blogs</span> ðŸš€
  </h2>
  <p class="ai-desc max-w-4xl mx-auto text-gray-600 text-xl font-light">
    The **AI Blog Generator** uses cutting-edge artificial intelligence to analyze video transcripts and craft
    <span class="font-medium text-purple-600">high-quality, SEO-ready blog posts</span> in seconds.
  </p>

</section>

<main class="flex-grow flex justify-center items-start px-4 py-8">
  <div
    class="glass rounded-3xl max-w-4xl w-full p-10 transition-all duration-300 transform hover:shadow-3xl hover:-translate-y-2 relative overflow-hidden">

    <div
      class="absolute top-[-100px] left-[-100px] w-64 h-64 bg-purple-300 opacity-20 rounded-full filter blur-3xl mix-blend-multiply pointer-events-none">
    </div>
    <div
      class="absolute bottom-[-100px] right-[-100px] w-64 h-64 bg-blue-300 opacity-20 rounded-full filter blur-3xl mix-blend-multiply pointer-events-none">
    </div>

    <div class="text-center mb-10 relative z-10">
      <h3 class="text-3xl font-bold text-indigo-700 mb-2 border-b-2 border-purple-300 inline-block pb-1">Get Started
        Instantly</h3>
      <p class="link-desc text-gray-600 font-light mt-2 font-bold">Paste a YouTube link below and watch AI craft your blog in seconds!</p>
    </div>

    <div class="mb-10 relative z-10">
      <label for="youtubeLink" class="block text-gray-700 font-bold mb-3 text-lg">
        <i class="fab fa-youtube text-red-600 mr-2"></i> Paste Your YouTube Video Link:
      </label>
      <div class="flex flex-col sm:flex-row gap-4">
        <input id="youtubeLink" type="url" placeholder="e.g., https://www.youtube.com/watch?v=dQw4w9WgXcQ"
          class="flex-grow p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-300 transition-all text-lg shadow-inner">

        <button id="generateBlogButton"
          class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-indigo-700 hover:to-purple-700 text-white px-8 py-4 rounded-xl font-extrabold text-lg transition-all shadow-xl hover:shadow-2xl transform hover:scale-105 active:scale-95 duration-200">
          <i class="fas fa-magic mr-2 animate-spin"></i>Generate Blog
        </button>
      </div>
    </div>

    <div id="loading-circle" class="load hidden"></div>

    <section id="output-section" class="mt-12 relative z-10">
      <h3 class="text-2xl font-bold mb-6 text-gray-800 flex items-center border-b pb-2">
        <i class="fas fa-feather-alt mr-3 text-purple-600"></i> Generated Blog Article
      </h3>
      <div id="blogContent"
        class="prose max-w-none text-gray-800 p-6 rounded-xl bg-white bg-opacity-80 border border-gray-200 shadow-inner min-h-[150px] space-y-4">
        <p class="text-gray-500 italic">Your amazing blog post will appear here after generation. Get ready to
          publish!</p>
      </div>
    </section>
  </div>
</main>

{% endblock %}


{% block scripts %}

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Ensure the initial placeholder is set
    const blogContent = document.getElementById('blogContent');
    if (blogContent.innerHTML.trim() === '') {
      blogContent.innerHTML = '<p class="text-gray-500 italic">Your amazing blog post will appear here after generation. Get ready to publish!</p>';
    }
  });

  document.getElementById('generateBlogButton').addEventListener('click', async () => {
    const youtubeLink = document.getElementById('youtubeLink').value.trim();
    const blogContent = document.getElementById('blogContent');
    const loader = document.getElementById('loading-circle');

    if (!youtubeLink) {
      alert("Please enter a YouTube link.");
      return;
    }

    loader.classList.remove('hidden');
    // Clear output and show a 'generating' message while loading
    blogContent.innerHTML = '<p class="text-indigo-600 font-medium text-center">AI is crafting your masterpiece... Please wait.</p>';

    try {
      const response = await fetch('/generate-blog', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ link: youtubeLink })
      });

      const data = await response.json();

      if (response.ok) {
        // Simplified markdown-to-html conversion for better readability
        const formattedContent = data.content
          .split('\n\n')
          .map(p => {
            // Simple header check for H2 (common in AI blog generation)
            if (p.startsWith('## ')) return `<h2 class="text-2xl font-semibold text-indigo-700 mt-6 mb-3">${p.substring(3)}</h2>`;
            if (p.startsWith('# ')) return `<h1 class="text-3xl font-bold text-purple-700 mb-4">${p.substring(2)}</h1>`;
            // Simple list check
            if (p.startsWith('- ') || p.startsWith('* ')) return `<ul class="list-disc list-inside ml-4 space-y-2">${p.split('\n').map(li => `<li>${li.substring(2).trim()}</li>`).join('')}</ul>`;
            return `<p class="leading-relaxed">${p}</p>`;
          })
          .join('');
        blogContent.innerHTML = formattedContent;
      } else {
        throw new Error(data.error || "An error occurred while generating the blog.");
      }

    } catch (error) {
      console.error("Error:", error);
      // Display error message in the output area
      blogContent.innerHTML = `<p class="text-red-500 font-bold text-center">Error: ${error.message}</p>`;
    } finally {
      loader.classList.add('hidden');
    }
  });
</script>

{% endblock %}