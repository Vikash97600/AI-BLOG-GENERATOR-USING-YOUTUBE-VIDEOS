{% extends "base.html" %}

{% block title %}All Blog Posts{% endblock %}

{% block head %}

<style>
    /* Set Poppins as the primary font for the entire body */
    body {
        font-family: 'Poppins', sans-serif;
    }

    /* Enhanced Glassmorphism Effect */
    .glass {
        background: rgba(255, 255, 255, 0.6);
        /* Slightly more transparent */
        backdrop-filter: blur(25px) saturate(180%);
        /* Increased blur and saturation */
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.35);
        /* Stronger shadow */
        border: 1px solid rgba(255, 255, 255, 0.4);
        /* Subtle white border */
    }

    .hover\:shadow-3xl:hover {
        box-shadow: 0 35px 60px -15px rgba(0, 0, 0, 0.4);
    }

    /* Default (Light Mode) */
    .folder-icon {
        color: #9CA3AF;
        /* gray-400 */
    }

    /* Dark Mode Folder Icon Color */
    .dark .folder-icon {
        color: #3B82F6 !important;
        /* blue-500 */
    }

    /* Light mode colors (unchanged) */
    .empty-title,
    .empty-desc {
        color: #4B5563;
        /* gray-600 */
    }

    /* Override in Dark Mode â€” make text black */
    .dark .empty-title,
    .dark .empty-desc {
        color: #000 !important;
    }



    /* Ensure the robot icon has a nice bounce */
    @keyframes bounce {

        0%,
        100% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(-10px);
        }
    }

    .animate-bounce {
        animation: bounce 1s infinite ease-in-out;
    }
</style>

{% endblock %}


{% block content %}

<main class="flex-grow flex justify-center items-start px-4 py-12">
    <div class="max-w-4xl w-full">
        <h2
            class="text-4xl font-extrabold text-purple-700 text-center mb-10 tracking-tight border-b-2 border-purple-300 inline-block pb-1 mx-auto block">
            Your Saved Blog Posts
        </h2>

        <div
            class="glass rounded-3xl p-10 transition-all duration-300 transform hover:shadow-3xl relative overflow-hidden space-y-6">

            <div
                class="absolute top-[-100px] left-[-100px] w-64 h-64 bg-purple-300 opacity-20 rounded-full filter blur-3xl mix-blend-multiply pointer-events-none">
            </div>
            <div
                class="absolute bottom-[-100px] right-[-100px] w-64 h-64 bg-blue-300 opacity-20 rounded-full filter blur-3xl mix-blend-multiply pointer-events-none">
            </div>

            <section class="relative z-10">
                <div class="space-y-4">
                    {% for article in blog_articles reversed %}
                    <a href="blog-details/{{article.id}}" class="block">
                        <div
                            class="bg-white bg-opacity-90 border border-gray-200 p-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.01] hover:border-indigo-400">
                            <h3 class="text-xl font-bold text-indigo-700 mb-1">
                                <i class="fas fa-file-alt mr-2 text-purple-500"></i>{{article.youtube_title}}
                            </h3>
                            <p class="text-gray-600 italic text-sm">
                                Generated: {{ article.timestamp|date:"M d, Y" }}
                            </p>
                            <p class="text-gray-700 mt-2">
                                {{article.generated_content|truncatechars:150}}
                            </p>
                            <span
                                class="mt-3 inline-block text-sm font-semibold text-purple-600 hover:text-purple-800">Read
                                Full Article &rarr;</span>

                            <button onclick="deleteBlog('{{ article.id }}')" title="Delete blog"
                                class="absolute top-2 right-3 z-20  hover:bg-grey-700 text-white p-2 rounded-full shadow-lg opacity-80 group-hover:opacity-100 transition">
                                <i class="fa-solid fa-trash text-red-700"></i>
                            </button>
                        </div>
                    </a>


                    {% endfor %}

                    {% if not blog_articles %}
                    <div class="text-center p-12">
                        <i class="fas fa-folder-open text-6xl folder-icon mb-4"></i>
                        <p class="text-xl font-semibold empty-title">You have not saved blog posts yet!</p>

                        <p class="empty-desc mt-2">
                            Generate your first blog post from a YouTube link on the
                            <a href="/" class="text-indigo-600 hover:underline font-medium">main page</a>.
                            </a>

                    </div>
                    {% endif %}
                </div>
            </section>
        </div>
    </div>
</main>

{% endblock %}


{% block scripts %}

<script>
    function deleteBlog(blogId) {
        if (!confirm("Sure! Want to move to trash bin?")) return;
        fetch('/delete-blog/' + blogId + '/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'),
            }
        })
            .then(response => {
                if (response.ok)
                    location.reload();
                else
                    alert('Error while moving to trash bin');
            });
    }

    // Helper to get csrf token for AJAX POSTs
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>

{% endblock %}